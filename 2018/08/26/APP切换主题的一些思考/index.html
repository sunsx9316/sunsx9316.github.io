<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> APPåˆ‡æ¢ä¸»é¢˜çš„ä¸€äº›æ€è€ƒ Â· jimhuangçš„åšå®¢</title><meta name="description" content="APPåˆ‡æ¢ä¸»é¢˜çš„ä¸€äº›æ€è€ƒ - jimhuang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/sunsx9316/favicon.png"><link rel="stylesheet" href="/sunsx9316/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://github.com/sunsx9316/atom.xml" title="jimhuangçš„åšå®¢"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/sunsx9316/atom.xml" title="jimhuangçš„åšå®¢" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/sunsx9316/" class="logo-link"><img src="/sunsx9316/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/sunsx9316/" target="_self" class="nav-list-link">åšå®¢</a></li><li class="nav-list-item"><a href="/sunsx9316/archives/" target="_self" class="nav-list-link">å½’æ¡£</a></li><li class="nav-list-item"><a href="https://github.com/sunsx9316" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">APPåˆ‡æ¢ä¸»é¢˜çš„ä¸€äº›æ€è€ƒ</h1><div class="post-info">2018å¹´8æœˆ26æ—¥</div><div class="post-content"><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>APPå†…åˆ‡æ¢ä¸»é¢˜æ˜¯æ¯”è¾ƒå¸¸è§çš„éœ€è¦ï¼Œè›®æ—©å°±æ€è€ƒè¿‡è¿™ä¸ªé—®é¢˜ã€‚ç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šçš„è§£å†³æ–¹æ¡ˆï¼Œä¸è¿‡æœ¬è´¨ä¸Šå…¶å®éƒ½ç±»ä¼¼ï¼Œæ— éæ˜¯ä¸¤ç§æƒ…å†µã€‚</p>
<ul>
<li>å¦‚æœéœ€è¦å®ç°ç±»ä¼¼æ‰‹Qé‚£æ ·åŠ¨æ€æ›´æ¢ä¸»é¢˜ï¼Œé‚£ä¹ˆä¸»é¢˜ä¸€å®šæ˜¯ä¸ªé…ç½®æ–‡ä»¶ï¼Œèƒ½å¤Ÿä»æœåŠ¡å™¨ä¸‹è½½ã€‚</li>
<li>å¦‚æœåªè¦æ±‚èƒ½æ›´æ¢æˆæœ¬åœ°çš„å‡ å¥—ä¸»é¢˜ï¼Œé‚£åªé€šè¿‡ä»£ç åˆå§‹åŒ–ï¼Œå†™æ­»ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</li>
</ul>
<p>è¯´è¯´ä¸¤è€…çš„ä¼˜ç¼ºç‚¹ã€‚</p>
<ul>
<li>ç¬¬ä¸€ç§æ¯”è¾ƒçµæ´»ï¼Œä½†æ˜¯å¼•å…¥çš„é…ç½®æ–‡ä»¶è‚¯å®šè¦æ±‚æ ¼å¼çš„é€šç”¨ï¼Œæ¯•ç«Ÿä¸å¤ªå¯èƒ½è¦æ±‚æœåŠ¡ç«¯é’ˆå¯¹ä¸åŒçš„è®¾å¤‡æä¾›ä¸åŒçš„é…ç½®ã€‚é‚£ä¹ˆå¾ˆå¤šäººæˆ–è®¸ä¼šé€‰æ‹©JSONæˆ–è€…XMLä¹‹ç±»çš„æ ¼å¼ã€‚è¿™æ ·å°±ä¼šå¯¼è‡´å¯è¯»æ€§ä¸é‚£ä¹ˆå¥½ï¼Œä¹Ÿä¸å¤ªç›´è§‚ï¼Œè€Œä¸”ä¹Ÿæ²¡åŠæ³•åœ¨ç¼–è¯‘æœŸå°±åšä»£ç æ£€æŸ¥ã€‚</li>
<li>ç¬¬äºŒç§å¯¹æ¯”ç¬¬ä¸€ç§å°±æ›´ç›´è§‚ï¼Œæ²¡æœ‰ä»€ä¹ˆèƒ½æ¯” <code>label.textColor = redColor</code> è¿™æ ·çš„ä»£ç æ›´æ˜“è¯»äº†å§ã€‚åŒæ—¶å› ä¸ºæ˜¯åŸç”Ÿå¼€å‘ï¼Œä¹Ÿå¯ä»¥åœ¨ç¼–è¯‘æœŸå°±åšåˆ°ä»£ç æ£€æŸ¥ï¼Œç¼ºç‚¹å°±æ˜¯çµæ´»æ€§å·®äº†äº›ã€‚</li>
</ul>
<p>æ‰€ä»¥è¦åšçš„å…¶å®æ˜¯é€‰æ‹©é€‚åˆè‡ªå·±çš„ç±»å‹ï¼Œè¿˜æœ‰å¦‚ä½•èƒ½æ›´ç®€å•çš„åšåˆ°åˆ‡æ¢è€Œå·²ã€‚è¿™ä¸ªè½®å­å…¶å®å¹¶ä¸å¤ªé€‚åˆé¡¹ç›®ï¼Œæ›´å¤šæ˜¯ä½œä¸ºæ€è€ƒã€‚å…¬å¸é¡¹ç›®å¹¶ä¸è¦æ±‚åšåˆ°ç±»ä¼¼æ‰‹Qé‚£æ ·åŠ¨æ€åˆ‡æ¢ä¸»é¢˜ï¼Œä½†æ˜¯ä¸ºäº†æ‹“å±•æ€§ï¼Œæˆ‘è¿˜æ˜¯è€ƒè™‘é€šè¿‡é…ç½®æ–‡ä»¶å»åŠ è½½ã€‚</p>
<h2 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„"></a>ç›®çš„</h2><p>å› ä¸ºå†™ä¸»é¢˜é…ç½®æ˜¯ååˆ†éº»çƒ¦çš„äº‹ï¼Œæˆ‘æƒ³è¦åšåˆ°çš„æ•ˆæœæ˜¯åªå†™é…ç½®æ–‡ä»¶ï¼Œä»£ç é‡Œä¸éœ€è¦å†™ä»»ä½•åˆ¤æ–­å’Œè®¾ç½®çš„é€»è¾‘å°±èƒ½åšåˆ°è‡ªåŠ¨æ ¹æ®å½“å‰ä¸»é¢˜åˆ‡æ¢æ ·å¼ã€‚æ‰€ä»¥è¦åšçš„äº‹åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p>
<ol>
<li>ä¹¦å†™é…ç½®</li>
<li>ç¨‹åºè¯»å–é…ç½®</li>
<li>ä»£ç æ ¹æ®å½“å‰ä¸»é¢˜è‡ªåŠ¨è®¾ç½®æ ·å¼</li>
</ol>
<p>åŒæ—¶é…ç½®æ–‡ä»¶è¦æ±‚å¯è¯»æ€§è‰¯å¥½ï¼Œå°±ç®—åˆ«äººæ¥æ‰‹äº†è¿™ä¸ªæ¨¡å—ä¹Ÿä¸éœ€è¦ç†Ÿæ‚‰ç‰¹å®šçš„é…ç½®ä¹¦å†™è¯­æ³•ã€‚</p>
<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p>å› ä¸ºæ˜¯æœ¬åœ°ä½¿ç”¨ï¼Œé‚£ä¹ˆå¯ä»¥ä¸è€ƒè™‘é€šç”¨æ€§ï¼Œä¸ºäº†å¼€å‘ç®€å•ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>Plist</code>å†™é…ç½®ã€‚ä¸ºäº†å¯è¯»æ€§è‰¯å¥½ï¼Œä¸”å°½é‡ä¸å¢åŠ å­¦ä¹ æˆæœ¬ï¼Œæˆ‘æƒ³åšåˆ°æœ€å¥½å†™åœ¨é…ç½®é‡Œçš„å°±æ˜¯ç±»ä¼¼ <code>label.textColor = redColor</code> è¿™æ ·çš„èµ‹å€¼è¯­å¥ã€‚é‚£èƒ½ä¸èƒ½åšåˆ°è¿™ä¸€ç‚¹å‘¢ï¼Œå½“ç„¶å¯ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©OCçš„KVCã€‚KVCæœ¬èº«ä¹Ÿæ”¯æŒkeyPathè¿™æ ·çš„èµ‹å€¼æ–¹å¼ï¼Œ<code>&quot;label.textColor&quot;</code> è¿™æ ·çš„å­—ç¬¦ä¸²åœ¨KVCä¸­ä¼šè¢«è§£ææˆæŸ¥æ‰¾ <code>label</code> ä¸‹çš„ <code>textColor</code> å±æ€§ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨ <code>Plist</code> é‡Œçš„ <code>key</code>å°±å¯ä»¥å®šä¹‰æˆ <code>&quot;label.textColor&quot;</code>ï¼Œè€Œ <code>value</code>å°±æ˜¯é¢œè‰²ã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œ<code>Plist</code> åªæ”¯æŒå­—ç¬¦ä¸²ã€æ•°å­—ã€æ—¥æœŸã€äºŒè¿›åˆ¶æµè¿™å‡ ç§æœ‰é™çš„æ ¼å¼ï¼Œé‚£æ€ä¹ˆè®©å®ƒæ”¯æŒé¢œè‰²å‘¢ï¼Ÿå¾ˆå®¹æ˜“è”æƒ³åˆ°é¢œè‰²16è¿›åˆ¶çš„è¡¨ç¤ºæ–¹å¼ï¼Œæ¯”å¦‚ç™½è‰²ä½¿ç”¨16è¿›åˆ¶è¡¨ç¤ºå°±æ˜¯ <code>#FFFFFF</code>ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²ä¸å°±å¥½äº†ã€‚ä½†æ˜¯é—®é¢˜æ²¡è¿™ä¹ˆç®€å•ã€‚</p>
<p>ä¸€ç§æ¯”è¾ƒå¸¸è§çš„éœ€æ±‚æ˜¯åœ¨ä¸åŒçš„ä¸»é¢˜ä¸‹éœ€è¦æ˜¾ç¤ºä¸åŒå›¾ç‰‡ (æ¯”å¦‚æˆ‘ä»¬å°±æœ‰ç™½å¤©å’Œé»‘å¤œæ¨¡å¼ï¼Œé»‘å¤œæ¨¡å¼çš„å›¾ç‰‡å°±è¦æ±‚æš—ä¸€äº›ã€‚å°å£°bbâ€¦â€¦)ï¼Œé¢œè‰²å¦‚æœä½¿ç”¨äº† <code>#FFFFFF</code> è¿™æ ·çš„æ–¹å¼è®¾ç½®ï¼Œé‚£ä¹ˆå›¾ç‰‡æ€ä¹ˆåŠï¼Ÿå›¾ç‰‡å¯ä»¥æ ¹æ®å›¾ç‰‡åï¼Œä½†æ˜¯ç¨‹åºéœ€è¦çŸ¥é“è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯ä»€ä¹ˆæ‰èƒ½æŠŠå®ƒè½¬æˆå¯¹åº”çš„ä¸œè¥¿ï¼Œæ‰€ä»¥å°±éœ€è¦å®šä¸€å¥—ç®€å•çš„è§„åˆ™äº†ã€‚</p>
<p>å­—ç¬¦ä¸²éå¸¸çµæ´»ï¼Œä»»æ„çš„ç»„åˆå¯ä»¥å¾—åˆ°å®Œå…¨ä¸åŒçš„å†…å®¹ï¼Œæ‰€ä»¥å¯¹äºè¿™ç§æƒ…å†µï¼Œé€‰æ‹©å­—ç¬¦ä¸²ç±»å‹æ˜¯æ¯”è¾ƒåˆé€‚çš„ã€‚ç±»ä¼¼ç¼–è¯‘å™¨ï¼Œæœ‰ä¸€å¥—è‡ªå·±çš„å¤æ‚çš„è§£æè§„åˆ™ï¼Œä¼šæŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºè¯­æ³•æ ‘ã€‚æˆ‘ä»¬ä¸éœ€è¦è¿™ä¹ˆå¤æ‚ï¼Œåªæ˜¯ç®€å•çš„æ ¼å¼å°±å¥½ï¼Œä½†æ˜¯å¯ä»¥è®¾è®¡æˆæ‹¥æœ‰å¾ˆå¼ºæ‹“å±•æ€§çš„æ¨¡å¼ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€äº›é€šç”¨çš„æ¥å£ï¼Œç”Ÿæˆä¸€äº›è§£æå™¨ï¼Œè¿™ä¼šåœ¨ç¬¬äºŒæ­¥è¯¦ç»†è¯´æ˜ã€‚</p>
<h3 id="è¯»å–é…ç½®"><a href="#è¯»å–é…ç½®" class="headerlink" title="è¯»å–é…ç½®"></a>è¯»å–é…ç½®</h3><p>è¿™ä¸€æ­¥æ¯”è¾ƒé‡è¦çš„æ˜¯æ¥å£çš„è®¾è®¡ï¼Œå…³ä¹åˆ°ä½¿ç”¨çš„æ–¹ä¾¿æ€§å’Œæœªæ¥çš„æ‹“å±•æ€§ã€‚</p>
<p>æˆ‘ä»¬æ¥ç€è¯´ç¬¬ä¸€æ­¥æœ«å°¾è¯´åˆ°çš„è§£æå™¨ã€‚ä¸ºä»€ä¹ˆè¦å®šä¹‰è§£æå™¨å‘¢ï¼Ÿé¦–å…ˆæ¯ä¸€ä¸ª <code>Plist</code>çš„å¯¹è±¡ï¼Œå€¼ä¼ è¿‡æ¥éƒ½æ˜¯ä¸ªå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬è¦æ ¹æ®é‡Œé¢å­—ç¬¦ä¸²çš„æ ¼å¼åˆ¤æ–­å®ƒæ˜¯åº”è¯¥è§£ææˆé¢œè‰²ï¼Œæˆ–è€…å›¾ç‰‡åˆæˆ–è€…æ˜¯å…¶å®ƒã€‚æ¯ç§æƒ…å†µéƒ½ä¸ä¸€æ ·ï¼Œæ‰€ä»¥æ‹†åˆ†æˆç‹¬ç«‹çš„è§£æå™¨ä¼šæ›´å¥½ã€‚ä¸è¿‡ä»–ä»¬éƒ½ç”¨ä¸€ä¸ªå…±åŒç‚¹ï¼Œéµå®ˆåŒä¸€ä¸ªåè®®ã€‚åè®®æˆ‘ä»¬è¿™æ ·å®šä¹‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> è§£æä¼˜å…ˆçº§</span><br><span class="line"></span><br><span class="line"> - JHThemeParserPriorityRequest: æœ€å…ˆè§£æ</span><br><span class="line"> - JHThemeParserPriorityNormal: æ™®é€š</span><br><span class="line"> - JHThemeParserPriorityUnimportance: æœ€åè§£æ</span><br><span class="line"> */</span><br><span class="line">typedef NS_ENUM(NSUInteger, JHThemeParserPriority) &#123;</span><br><span class="line">    JHThemeParserPriorityUnimportance,</span><br><span class="line">    JHThemeParserPriorityNormal,</span><br><span class="line">    JHThemeParserPriorityRequest = 1000,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">@class JHTheme;</span><br><span class="line">@protocol JHThemeParserProtocol &lt;NSObject&gt;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> è§£æä¼˜å…ˆçº§</span><br><span class="line"> */</span><br><span class="line">@property (nonatomic, assign, readonly) JHThemeParserPriority priority;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> å”¯ä¸€æ ‡è¯†</span><br><span class="line"> */</span><br><span class="line">@property (nonatomic, copy, readonly) NSString *identify;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> æ˜¯å¦åœ¨è§£æä¹‹åç›´æ¥è¿”å› YESä¼šå°†è§£æç»“æœè®©ä¹‹åçš„è§£æå™¨ç»§ç»­è§£æ</span><br><span class="line"> */</span><br><span class="line">@property (nonatomic, assign, readonly) BOOL continueParse;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> æ˜¯å¦èƒ½è§£æè¿™ä¸ªå€¼</span><br><span class="line"></span><br><span class="line"> @param value å€¼</span><br><span class="line"> @return æ˜¯å¦èƒ½è§£æè¿™ä¸ªå€¼</span><br><span class="line"> */</span><br><span class="line">- (BOOL)canParseValue:(id)value;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> è§£æå…·ä½“å®ç°</span><br><span class="line"></span><br><span class="line"> @param value å€¼</span><br><span class="line"> @param currentTheme å½“å‰ä¸»é¢˜</span><br><span class="line"> @return è§£æç»“æœ</span><br><span class="line"> */</span><br><span class="line">- (id)converValue:(id)value currentTheme:(JHTheme *)currentTheme;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>é‡è¦çš„æ˜¯è¿™ä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)canParseValue:(id)value;</span><br><span class="line">- (id)converValue:(id)value currentTheme:(JHTheme *)currentTheme;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ä¸ªæ–¹æ³•åˆ¤æ–­è¿™ä¸ªè§£æå™¨èƒ½å¦è§£æè¿™ä¸ªå­—ç¬¦ä¸²ã€‚</p>
<ul>
<li>å¦‚æœè¿”å› <code>true</code> ï¼Œ é‚£ä¹ˆä¼šæ¥ç€è°ƒç”¨<code>converValue:(id)value currentTheme:(JHTheme *)currentTheme</code>ï¼Œè®©è§£æå™¨è‡ªå·±å†…éƒ¨è¿›è¡Œè§£æã€‚</li>
<li>å¦‚æœè¿”å› <code>false</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªè§£æå™¨å°±æ— æ³•è§£æè¿™ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿä¸ä¼šæœ‰ä¹‹åçš„è°ƒç”¨äº†ã€‚</li>
</ul>
<p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œè¿™æ˜¯é¢œè‰²è§£æå™¨å†…éƒ¨çš„å®ç°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">@implementation JHThemeColorParser</span><br><span class="line">- (BOOL)canParseValue:(NSString *)value &#123;</span><br><span class="line">    if ([value isKindOfClass:[NSString class]] &amp;&amp; ([value hasPrefix:@&quot;c(&quot;] || [value hasPrefix:@&quot;C(&quot;]) &amp;&amp; [value hasSuffix:@&quot;)&quot;]) &#123;</span><br><span class="line">        return YES;</span><br><span class="line">    &#125;</span><br><span class="line">    return NO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)converValue:(NSString *)value currentTheme:(JHTheme *)currentTheme &#123;</span><br><span class="line">    //å–å‡ºè‰²å€¼</span><br><span class="line">    value = [value substringWithRange:NSMakeRange(2, value.length - 3)];</span><br><span class="line">    NSArray &lt;NSString *&gt;*rgba = [value componentsSeparatedByString:@&quot;,&quot;];</span><br><span class="line">    //16è¿›åˆ¶</span><br><span class="line">    if (rgba.count == 1) &#123;</span><br><span class="line">        return [UIColor colorWithHexString:value];</span><br><span class="line">    &#125;</span><br><span class="line">    else if (rgba.count &gt;= 3) &#123;</span><br><span class="line">        CGFloat r = 0,g = 0,b = 0,a = 1;</span><br><span class="line">        r = rgba.firstObject.doubleValue / 255.0;</span><br><span class="line">        g = rgba[1].doubleValue / 255.0;</span><br><span class="line">        b = rgba[2].doubleValue / 255.0;</span><br><span class="line">        if (rgba.count &gt;= 4) &#123;</span><br><span class="line">            a = rgba[3].doubleValue;</span><br><span class="line">        &#125;</span><br><span class="line">        return [UIColor colorWithRed:r green:g blue:b alpha:a];</span><br><span class="line">    &#125;</span><br><span class="line">    return value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆ <code>- (BOOL)canParseValue:(id)value</code> è¿™ä¸ªæ–¹æ³•çš„å®ç°æ˜¯åˆ¤æ–­å€¼æ˜¯å¦ç¬¦åˆè§„åˆ™ï¼Œè¿™é‡Œæˆ‘å®šä¹‰æˆç¬¦åˆ <code>c(#FFFFF)</code> æˆ–è€… <code>c(255,255,255)</code> æ ¼å¼çš„å­—ç¬¦ä¸²å°±å¯ä»¥è§£æã€‚å‰è€…æ˜¯é¢œè‰²çš„16è¿›åˆ¶è¡¨ç¤ºæ³•ï¼Œåè€…æ˜¯é€šè¿‡æŒ‡å®šRGBæ•°å­—çš„é¢œè‰²è¡¨ç¤ºæ³•ã€‚è€Œä¸‹é¢åªæ˜¯å¯¹è¿™ä¸ªè§£ææ ¼å¼çš„å®ç°è€Œå·²ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¦‚æœæƒ³å®šä¹‰ä¸€å¥—æ¯”è¾ƒå¤æ‚çš„è§£æè§„åˆ™ï¼Œåªè¦å®ç°åè®®ï¼Œè‡ªå·±å†™è§£æé€»è¾‘å°±å¥½äº†ã€‚æ¯”å¦‚é™¤äº†é¢œè‰²çš„ï¼Œæˆ‘è¿˜å®ç°äº†ä¸€äº›ç±»ä¼¼å®çš„è§£æé€»è¾‘ã€‚åƒè¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)canParseValue:(NSString *)value &#123;</span><br><span class="line">    if ([value isKindOfClass:[NSString class]] &amp;&amp; ([value hasPrefix:@&quot;d(&quot;] || [value hasPrefix:@&quot;D(&quot;]) &amp;&amp; [value hasSuffix:@&quot;)&quot;]) &#123;</span><br><span class="line">        return YES;</span><br><span class="line">    &#125;</span><br><span class="line">    return NO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)converValue:(NSString *)value currentTheme:(JHTheme *)currentTheme &#123;</span><br><span class="line">    NSString *tempStr = [[value substringWithRange:NSMakeRange(2, value.length - 3)] stringByTrim];</span><br><span class="line">    NSDictionary *mapDic = currentTheme.defineMap;</span><br><span class="line">    id map = mapDic[tempStr];</span><br><span class="line">    if (map) &#123;</span><br><span class="line">        return map;</span><br><span class="line">    &#125;</span><br><span class="line">    return value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (BOOL)continueParse &#123;</span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (JHThemeParserPriority)priority &#123;</span><br><span class="line">    return JHThemeParserPriorityRequest;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœºæ™¯æ˜¯APPæœ‰ä¸€ä¸ªä¸»é¢˜è‰²ï¼Œå¦‚æœæŒ‰ç…§ä¸Šé¢åªæ˜¯é€šè¿‡æŒ‡å®šé¢œè‰²å»å†™ï¼Œé‚£å°±ä¼šå¾ˆéº»çƒ¦ï¼Œè€Œä¸”ä¸€æ—¦ä¸»é¢˜è‰²æ›´æ¢ï¼Œä¹Ÿè¦å…¨å±€ä¿®æ”¹ã€‚è¿™ä¸ªå®è§£æå™¨å°±å®šä¹‰äº†ä¸€ç§å­—ç¬¦ä¸²æ ¼å¼åƒè¿™æ · <code>d(mainColor)</code>ã€‚é…ç½®æ–‡ä»¶æœ‰ä¸€ä¸ªç‹¬ç«‹çš„â€å®å­—å…¸â€ï¼Œè§£æå™¨å–å‡º <code>mainColor</code> ç„¶ååœ¨â€å®å­—å…¸â€é‡ŒæŸ¥æ‰¾ <code>mainColor</code>å¯¹åº”çš„ <code>value</code>æ˜¯ä»€ä¹ˆï¼Œè¿™ä¸ª <code>value</code> æˆ‘åªè¦å®šä¹‰æˆ<code>c(#FFFFF)</code> æˆ–è€…å…¶å®ƒè§£æå™¨å¯ä»¥è§£æçš„æ ¼å¼ï¼Œå°±å¯ä»¥åšåˆ°ç±»ä¼¼å®å®šä¹‰çš„æ›¿æ¢æ•ˆæœã€‚éœ€è¦æ³¨æ„çš„æ˜¯ <code>- (BOOL)continueParse</code> éœ€è¦è¿”å› <code>YES</code>ï¼Œè¿™æ ·è§£æçš„ç»“æœæ‰èƒ½è¿”å›ç»™å…¶å®ƒçš„è§£æå™¨ç»§ç»­è§£æã€‚</p>
<p>æ‰€ä»¥å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ ·æ˜¯éå¸¸çµæ´»çš„ã€‚</p>
<h3 id="è‡ªåŠ¨è®¾ç½®æ ·å¼"><a href="#è‡ªåŠ¨è®¾ç½®æ ·å¼" class="headerlink" title="è‡ªåŠ¨è®¾ç½®æ ·å¼"></a>è‡ªåŠ¨è®¾ç½®æ ·å¼</h3><p>è¿™ä¸€æ­¥å…¶å®ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå®¹æ˜“äº†ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸å°‘å€¼å¾—è¯´çš„åœ°æ–¹ã€‚æˆ‘è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªå« <code>themeManager</code> çš„ä¸»é¢˜ç®¡ç†ç±»ã€‚æ¥å£è¿™æ ·è®¾è®¡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> è‡ªå®šä¹‰æ“ä½œblock</span><br><span class="line"></span><br><span class="line"> @param aObj æ›´æ”¹çš„å¯¹è±¡</span><br><span class="line"> @param key é”®</span><br><span class="line"> @param value å€¼</span><br><span class="line"> @return è‡ªå®šä¹‰æ›´æ”¹çš„å¯¹è±¡</span><br><span class="line"> */</span><br><span class="line">typedef id(^JHThemeCustomAction)(id aObj, NSString *key, id value);</span><br><span class="line"></span><br><span class="line">@class JHThemeManager;</span><br><span class="line">@protocol JHThemeManagerObserver&lt;NSObject&gt;</span><br><span class="line">@optional</span><br><span class="line">//ä¸»é¢˜æ”¹å˜å›è°ƒ</span><br><span class="line">- (void)themeManager:(JHThemeManager *)themeManager didChangeTheme:(JHTheme *)theme;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface JHThemeManager : NSObject</span><br><span class="line">+ (instancetype)shareThemeManager;</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong, readonly) JHTheme *currentTheme;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> æ³¨å†Œè‡ªå®šä¹‰è§£æå™¨</span><br><span class="line"></span><br><span class="line"> @param parserClass è§£æå™¨éœ€è¦å®ç° JHThemeParserProtocolæ¥å£</span><br><span class="line"> */</span><br><span class="line">- (void)registerParser:(Class)parserClass;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> æ·»åŠ å•ä¸ªä¸»é¢˜</span><br><span class="line"></span><br><span class="line"> @param theme ä¸»é¢˜å¯¹è±¡</span><br><span class="line"> */</span><br><span class="line">- (void)addTheme:(JHTheme *)theme;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> æ·»åŠ å¤šä¸ªä¸»é¢˜</span><br><span class="line"></span><br><span class="line"> @param themes ä¸»é¢˜æ•°ç»„</span><br><span class="line"> */</span><br><span class="line">- (void)addThemes:(NSArray &lt;JHTheme *&gt;*)themes;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> æ ¹æ®ä¸»é¢˜åç§°æ›´æ”¹å½“å‰ä¸»é¢˜</span><br><span class="line"></span><br><span class="line"> @param themeName ä¸»é¢˜åç§°</span><br><span class="line"> */</span><br><span class="line">- (void)updateThemeByName:(NSString *)themeName;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> æ ¹æ®å½“å‰ä¸»é¢˜æ›´æ–°å¯¹è±¡çš„æ ·å¼</span><br><span class="line"></span><br><span class="line"> @param obj å¯¹è±¡</span><br><span class="line"> @param themeKey ä¸»é¢˜ä¸‹çš„Key ç©ºåˆ™ä¸ºobjçš„ç±»å</span><br><span class="line"> @param block è‡ªå®šä¹‰æ“ä½œ</span><br><span class="line"> */</span><br><span class="line">- (void)updateObjStyleWithCurrentTheme:(id)obj</span><br><span class="line">                              themeKey:(NSString *)themeKey</span><br><span class="line">                                 block:(JHThemeCustomAction)block;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> æ ¹æ®å½“å‰ä¸»é¢˜æ›´æ–°å¯¹è±¡çš„æ ·å¼</span><br><span class="line"></span><br><span class="line"> @param obj å¯¹è±¡</span><br><span class="line"> @param themeKey ä¸»é¢˜ä¸‹çš„Key ç©ºåˆ™ä¸ºobjçš„ç±»å</span><br><span class="line"> @param themeName ä¸»é¢˜åç§°</span><br><span class="line"> @param block è‡ªå®šä¹‰æ“ä½œ</span><br><span class="line"> */</span><br><span class="line">- (void)updateObjStyleWithCurrentTheme:(id)obj</span><br><span class="line">                              themeKey:(NSString *)themeKey</span><br><span class="line">                             themeName:(NSString *)themeName</span><br><span class="line">                                 block:(JHThemeCustomAction)block;</span><br><span class="line"></span><br><span class="line">- (void)addObserver:(id&lt;JHThemeManagerObserver&gt;)observer;</span><br><span class="line">- (void)removeObserver:(id&lt;JHThemeManagerObserver&gt;)observer;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p><code>- (void)registerParser:(Class)parserClass</code> æ³¨å†Œçš„æ˜¯éµå®ˆäº†è§£æå™¨åè®®çš„ç±»ï¼Œåªæœ‰æ³¨å†Œäº†æ‰æ”¯æŒè§£æè¿™ç§ç±»å‹çš„å­—ç¬¦ä¸²ã€‚å†…éƒ¨å®ç°æ˜¯é€šè¿‡æ•°ç»„ä¿å­˜ç¤ºä¾‹ï¼Œè§£æçš„æ—¶å€™æ ¹æ®ä¼˜å…ˆçº§å¾ªç¯è°ƒç”¨å·²ç»æ³¨å†Œçš„è§£æå™¨è¿›è¡Œè§£æã€‚</p>
<p>ç„¶åé‡ç‚¹æ˜¯è‡ªåŠ¨ã€‚å› ä¸ºæˆ‘ä»¬çš„ <code>key</code> æ˜¯ <code>keyPath</code>çš„å½¢å¼ï¼Œæ‰€ä»¥ç›´æ¥é€šè¿‡KVCæŠŠè§£æç»“æœèµ‹å€¼å°±è¡Œã€‚</p>
<p>å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line">- (void)updateObjStyleWithCurrentTheme:(id)toObj</span><br><span class="line">                              themeKey:(NSString *)themeKey</span><br><span class="line">                             themeName:(NSString *)themeName</span><br><span class="line">                                 block:(JHThemeCustomAction)block &#123;</span><br><span class="line">    if (toObj == nil) return;</span><br><span class="line"></span><br><span class="line">    if (themeKey.length == 0) &#123;</span><br><span class="line">        themeKey = NSStringFromClass([toObj class]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    JHTheme *aTheme = nil;</span><br><span class="line">    if (themeName.length == 0) &#123;</span><br><span class="line">        aTheme = self.currentTheme;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        aTheme = [self themeByName:themeName];</span><br><span class="line">    &#125;</span><br><span class="line">    //è·å–å½“å‰ä¸»é¢˜æ‰€æœ‰å­˜å‚¨çš„å†…å®¹</span><br><span class="line">    NSDictionary *content = aTheme.content[themeKey];</span><br><span class="line">    if ([content isKindOfClass:[NSDictionary class]] == NO) return;</span><br><span class="line"></span><br><span class="line">    [content enumerateKeysAndObjectsUsingBlock:^(NSString * _Nonnull key, id _Nonnull obj, BOOL * _Nonnull stop) &#123;</span><br><span class="line"></span><br><span class="line">        //è‡ªå®šä¹‰ä¿®æ”¹</span><br><span class="line">        if (block) &#123;</span><br><span class="line">            obj = block(toObj, key, [self converValueWithObj:obj]);</span><br><span class="line">            if (obj == nil) return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        NSString *cacheKey = [themeKey stringByAppendingFormat:@&quot;.%@&quot;, key];</span><br><span class="line">        NSNumber *cache = [self.keyPathCache objectForKey:cacheKey];</span><br><span class="line">        //æ²¡æœ‰ç¼“å­˜è¿‡</span><br><span class="line">        if (cache == nil) &#123;</span><br><span class="line">            NSArray &lt;NSString *&gt;*keyPaths = [key componentsSeparatedByString:@&quot;.&quot;];</span><br><span class="line"></span><br><span class="line">            id lastObj = toObj;</span><br><span class="line"></span><br><span class="line">            //å•ä¸ªkey</span><br><span class="line">            if (keyPaths.count == 1) &#123;</span><br><span class="line">                //å½“å‰keyä¸å­˜åœ¨</span><br><span class="line">                BOOL exist = [lastObj respondsToSelector:NSSelectorFromString(keyPaths.firstObject)];</span><br><span class="line">                NSAssert(exist, @&quot;%@ä¸å­˜åœ¨ è®¾ç½®ä¸»é¢˜å¤±è´¥&quot;, key);</span><br><span class="line"></span><br><span class="line">                if (exist == false) &#123;</span><br><span class="line">                    cache = @(NO);</span><br><span class="line">                    [self.keyPathCache setObject:cache forKey:cacheKey];</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">                else &#123;</span><br><span class="line">                    cache = @(YES);</span><br><span class="line">                    [self.keyPathCache setObject:cache forKey:cacheKey];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            //keyPath</span><br><span class="line">            else &#123;</span><br><span class="line">                BOOL flag = YES;</span><br><span class="line">                for (NSInteger i = 0; i &lt; keyPaths.count - 1; ++i) &#123;</span><br><span class="line">                    NSString *key = keyPaths[i];</span><br><span class="line">                    SEL selector = NSSelectorFromString(key);</span><br><span class="line">                    if ([lastObj respondsToSelector:selector]) &#123;</span><br><span class="line">                        lastObj = [lastObj valueForKey:key];</span><br><span class="line">                    &#125;</span><br><span class="line">                    else &#123;</span><br><span class="line">                        flag = NO;</span><br><span class="line">                        break;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                if (flag) &#123;</span><br><span class="line">                    flag = [lastObj respondsToSelector:NSSelectorFromString(keyPaths.lastObject)];</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                cache = @(flag);</span><br><span class="line">                [self.keyPathCache setObject:cache forKey:cacheKey];</span><br><span class="line">                if (flag == NO) &#123;</span><br><span class="line">                    NSLog(@&quot;%@ä¸å­˜åœ¨ è®¾ç½®ä¸»é¢˜å¤±è´¥&quot;, key);</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //keyæ— æ•ˆ</span><br><span class="line">        if (cache.boolValue == NO) return;</span><br><span class="line"></span><br><span class="line">        //å¤šå‚æ•°</span><br><span class="line">        if ([key containsString:@&quot;:&quot;]) &#123;</span><br><span class="line">            NSArray *separatedValues = [key componentsSeparatedByString:@&quot;.&quot;];</span><br><span class="line">            NSString *method = separatedValues.lastObject;</span><br><span class="line">            SEL aSEL = NSSelectorFromString(method);</span><br><span class="line">            //çœŸæ­£å‘æ¶ˆæ¯çš„å¯¹è±¡</span><br><span class="line">            id sendObj = [toObj valueForKeyPath:[key stringByReplacingOccurrencesOfString:[NSString stringWithFormat:@&quot;.%@&quot;, method] withString:@&quot;&quot;]];</span><br><span class="line"></span><br><span class="line">            NSArray *valueArr = [obj isKindOfClass:[NSArray class]] ? obj : @[obj];</span><br><span class="line">            YYClassMethodInfo *info = [[YYClassMethodInfo alloc] initWithMethod:class_getInstanceMethod([sendObj class], aSEL)];</span><br><span class="line">            //å†’å·ä¹‹åçš„å‚æ•°ä¸ºå®é™…å‚æ•°</span><br><span class="line">            NSArray &lt;NSString *&gt;*argumentTypeEncodings = ^&#123;</span><br><span class="line">                NSInteger index = [info.argumentTypeEncodings indexOfObject:@&quot;:&quot;];</span><br><span class="line">                if (index != NSNotFound) &#123;</span><br><span class="line">                    return (NSArray *)[info.argumentTypeEncodings subarrayWithRange:NSMakeRange(index + 1, info.argumentTypeEncodings.count - index - 1)];</span><br><span class="line">                &#125;</span><br><span class="line">                return @[];</span><br><span class="line">            &#125;();</span><br><span class="line"></span><br><span class="line">            //å‚æ•°ä¸ªæ•°å’Œkeyçš„æ–¹æ³•ä¸ä¸€è‡´</span><br><span class="line">            if (argumentTypeEncodings.count != valueArr.count) &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            NSMethodSignature *sign = [sendObj methodSignatureForSelector:aSEL];</span><br><span class="line">            NSInvocation *invocation = [NSInvocation invocationWithMethodSignature:sign];</span><br><span class="line">            invocation.target = sendObj;</span><br><span class="line">            invocation.selector = aSEL;</span><br><span class="line"></span><br><span class="line">            for (NSInteger idx1 = 0; idx1 &lt; argumentTypeEncodings.count; ++idx1) &#123;</span><br><span class="line">                id obj1 = valueArr[idx1];</span><br><span class="line">                id tempObj = [self converValueWithObj:obj1];</span><br><span class="line">                YYEncodingType encodingType = YYEncodingGetType(argumentTypeEncodings[idx1].UTF8String);</span><br><span class="line">                switch (encodingType) &#123;</span><br><span class="line">                    case YYEncodingTypeBool:</span><br><span class="line">                    &#123;</span><br><span class="line">                        BOOL aValue = [tempObj boolValue];</span><br><span class="line">                        [invocation setArgument:&amp;aValue atIndex:idx1 + 2];</span><br><span class="line">                    &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case YYEncodingTypeInt8:</span><br><span class="line">                    &#123;</span><br><span class="line">                        char aValue = [tempObj charValue];</span><br><span class="line">                        [invocation setArgument:&amp;aValue atIndex:idx1 + 2];</span><br><span class="line">                    &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case YYEncodingTypeUInt8:</span><br><span class="line">                    &#123;</span><br><span class="line">                        unsigned char aValue = [tempObj unsignedCharValue];</span><br><span class="line">                        [invocation setArgument:&amp;aValue atIndex:idx1 + 2];</span><br><span class="line">                    &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case YYEncodingTypeInt16:</span><br><span class="line">                    &#123;</span><br><span class="line">                        short aValue = [tempObj shortValue];</span><br><span class="line">                        [invocation setArgument:&amp;aValue atIndex:idx1 + 2];</span><br><span class="line">                    &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case YYEncodingTypeUInt16:</span><br><span class="line">                    &#123;</span><br><span class="line">                        unsigned short aValue = [tempObj unsignedShortValue];</span><br><span class="line">                        [invocation setArgument:&amp;aValue atIndex:idx1 + 2];</span><br><span class="line">                    &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case YYEncodingTypeInt32:</span><br><span class="line">                    &#123;</span><br><span class="line">                        int32_t aValue = [tempObj intValue];</span><br><span class="line">                        [invocation setArgument:&amp;aValue atIndex:idx1 + 2];</span><br><span class="line">                    &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case YYEncodingTypeUInt32:</span><br><span class="line">                    &#123;</span><br><span class="line">                        uint32_t aValue = [tempObj intValue];</span><br><span class="line">                        [invocation setArgument:&amp;aValue atIndex:idx1 + 2];</span><br><span class="line">                    &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case YYEncodingTypeInt64:</span><br><span class="line">                    &#123;</span><br><span class="line">                        long long aValue = [tempObj longLongValue];</span><br><span class="line">                        [invocation setArgument:&amp;aValue atIndex:idx1 + 2];</span><br><span class="line">                    &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case YYEncodingTypeUInt64:</span><br><span class="line">                    &#123;</span><br><span class="line">                        unsigned long long aValue = [tempObj unsignedLongLongValue];</span><br><span class="line">                        [invocation setArgument:&amp;aValue atIndex:idx1 + 2];</span><br><span class="line">                    &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case YYEncodingTypeFloat:</span><br><span class="line">                    &#123;</span><br><span class="line">                        float aValue = [tempObj floatValue];</span><br><span class="line">                        [invocation setArgument:&amp;aValue atIndex:idx1 + 2];</span><br><span class="line">                    &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case YYEncodingTypeDouble:</span><br><span class="line">                    &#123;</span><br><span class="line">                        double aValue = [tempObj doubleValue];</span><br><span class="line">                        [invocation setArgument:&amp;aValue atIndex:idx1 + 2];</span><br><span class="line">                    &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case YYEncodingTypeLongDouble:</span><br><span class="line">                    &#123;</span><br><span class="line">                        long double aValue = [tempObj doubleValue];</span><br><span class="line">                        [invocation setArgument:&amp;aValue atIndex:idx1 + 2];</span><br><span class="line">                    &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case YYEncodingTypeObject:</span><br><span class="line">                    &#123;</span><br><span class="line">                        [invocation setArgument:&amp;tempObj atIndex:idx1 + 2];</span><br><span class="line">                    &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    default:</span><br><span class="line">                        break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            //è°ƒç”¨</span><br><span class="line">            [invocation invoke];</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            [toObj setValue:[self converValueWithObj:obj] forKeyPath:key];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>è¿™ä¹ˆé•¿ä¸€æ®µä»£ç ï¼Œæˆ‘éƒ½ä¸æƒ³çœ‹ğŸ˜‘ï¼Œå¹¸å¥½è¿˜è®°å¾—æ€ä¹ˆå®ç°çš„ã€‚æŒ‰ç…§ä¸Šé¢æˆ‘ä»¬è¯´çš„ï¼Œåº”è¯¥éå¸¸ç®€å•æ‰å¯¹ï¼Œä½†æ˜¯å®é™…ä¸Šè¿˜è¦å¤„ç†ä¸€äº›å…¶ä»–æƒ…å†µã€‚ä¸¾ä¸ªä¾‹å­ï¼Œ<code>UIButton</code> åœ¨è®¾ç½®å›¾ç‰‡ã€æ–‡å­—é¢œè‰²ç­‰å±æ€§çš„æ—¶å€™éœ€è¦å¸¦ä¸Š <code>UIControlState</code>ï¼Œé‚£å°±éœ€è¦ä¼ ä¸¤ä¸ªå‚æ•°ã€‚<code>Plist</code>å¯ä»¥æŠŠè¿™ç§å¤šå‚æ•°ä¿å­˜ä¸ºæ•°ç»„ï¼Œä½†æ˜¯KVCå°±æ²¡åŠæ³•åšåˆ°èµ‹å€¼äº†ï¼Œè¿™æ—¶å€™å°±è¦å€ŸåŠ©åˆ°OCçš„è¿è¡Œæ—¶äº†ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼ŒOCçš„æ–¹æ³•è°ƒç”¨ï¼Œæœ¬è´¨éƒ½æ˜¯å‘é€æ¶ˆæ¯ï¼Œè€Œæ¶ˆæ¯çš„å‚æ•°æ˜¯ä¸ç¡®å®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å€ŸåŠ©åº•å±‚æä¾›çš„ <code>NSInvocation</code> è¿™ç§é€šè¿‡æ–¹æ³•ç­¾åå‘æ¶ˆæ¯çš„ç±»ã€‚å¦‚æœäº†è§£è¿‡OCçš„æ¶ˆæ¯è½¬å‘æœºåˆ¶çš„åŒå­¦ï¼Œåº”è¯¥è§è¿‡è¿™ä¸ªç±»ã€‚å®ƒå…¶å®æ˜¯ä¸€ä¸ªè°ƒç”¨å™¨ï¼Œè®¾ç½®äº†æ–¹æ³•ç­¾åï¼Œå†è®¾ç½®äº†å‚æ•°å°±å¯ä»¥åƒæ™®é€šæ¶ˆæ¯å‘é€äº†ã€‚æ–¹æ³•åæˆ‘ä»¬å®šä¹‰æˆé…ç½®çš„ <code>key</code>ï¼Œå¤šå‚æ•°å°±å’ŒOCçš„æ–¹æ³•åä¸€æ ·ï¼Œç”¨â€:â€éš”å¼€ï¼Œç±»ä¼¼è¿™æ ·ï¼š<code>setImage:forState</code>ï¼Œ<code>value</code> æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚å®ç°ç”¨äº†YYKitçš„ä¸€äº›æ–¹æ³•ï¼Œåªæ˜¯å†™èµ·æ¥ç®€å•ä¸€äº›ï¼Œå†…éƒ¨å°±æ˜¯è°ƒç”¨runtimeçš„APIï¼Œè¿™æ ·å°±åšåˆ°äº†å¤šå‚æ•°çš„å…¼å®¹ã€‚</p>
<p>ç„¶è€Œå®é™…ä½¿ç”¨çš„æ—¶å€™ï¼Œå…¶å®å¾ˆéº»çƒ¦ã€‚æœ‰ä¸€ä¸ªæ¯”è¾ƒå·§å¦™çš„æ–¹å¼æ˜¯é€šè¿‡åˆ†ç±»å»æ·»åŠ å‚æ•°ã€‚æ¯”å¦‚ <code>UIButton</code> çš„ <code>setImage:forState</code>ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ è¿™äº›åˆ†ç±»ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic, strong) UIImage *jh_normalImg;</span><br><span class="line">@property (nonatomic, strong) UIImage *jh_hightlightedImg;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>å®ç°æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- (void)setJh_normalImg:(UIImage *)jh_normalImg &#123;</span><br><span class="line">    [self setImage:jh_normalImg forState:UIControlStateNormal];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UIImage *)jh_normalImg &#123;</span><br><span class="line">    return [self imageForState:UIControlStateNormal];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setJh_hightlightedImg:(UIImage *)jh_hightlightedImg &#123;</span><br><span class="line">    [self setImage:jh_hightlightedImg forState:UIControlStateHighlighted];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UIImage *)jh_hightlightedImg &#123;</span><br><span class="line">    return [self imageForState:UIControlStateHighlighted];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡åˆ†ç±»æŒ‡å®šå…¶å®ƒçš„å‚æ•°å°±å¯ä»¥åƒå•ä¸ªå‚æ•°é‚£æ ·ä½¿ç”¨äº†ã€‚</p>
<p>è‡³äºè‡ªåŠ¨è°ƒç”¨ï¼Œå…¶å®å¾ˆç®€å•ã€‚æˆ‘ä»¬ç»™ <code>NSObject</code> æ·»åŠ ä¸€ä¸ªåˆ†ç±»ï¼Œå®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@implementation NSObject (JHThemeManager)</span><br><span class="line"></span><br><span class="line">- (void)jh_updateTheme &#123;</span><br><span class="line">    [self jh_updateThemeByKey:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)jh_updateThemeByKey:(NSString *)key &#123;</span><br><span class="line">    [self jh_updateThemeByKey:key block:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)jh_updateThemeByKey:(NSString *)key</span><br><span class="line">                      block:(JHThemeCustomAction)block &#123;</span><br><span class="line">    [self jh_updateThemeByKey:key theme:nil block:block];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)jh_updateThemeByKey:(NSString *)key</span><br><span class="line">                      theme:(NSString *)theme</span><br><span class="line">                      block:(JHThemeCustomAction)block &#123;</span><br><span class="line">    [[JHThemeManager shareThemeManager] updateObjStyleWithCurrentTheme:self themeKey:key themeName:theme block:block];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p>å…¶å®ä¹Ÿåªä¸è¿‡æ˜¯å¯¹ <code>[[JHThemeManager shareThemeManager] updateObjStyleWithCurrentTheme:self themeKey:key themeName:theme block:block];</code> çš„å°è£…ï¼Œè¿™ä¸ªkeyæ˜¯é…ç½®é‡Œçš„ <code>key</code>ï¼Œä¸€èˆ¬å®šä¹‰æˆç±»åã€‚<code>theme</code> å°±æ˜¯ä¸»é¢˜çš„åå­—ï¼Œä¼  <code>nil</code>çš„è¯å°±è·å–å½“å‰ä¸»é¢˜ã€‚ç„¶ååˆ›å»ºåœ¨ä½ çš„æ§åˆ¶å™¨åŸºç±»ã€å„ç§Viewçš„åŸºç±»ä¸­åˆé€‚çš„æ—¶æœºè°ƒç”¨ <code>- (void)jh_updateTheme</code> å°±ä¼šè‡ªåŠ¨åœ¨ç”Ÿæˆæ—¶è¿›è¡Œä¸»é¢˜è®¾ç½®ã€‚</p>
<p>é…ç½®æ–‡ä»¶æ˜¯è¿™æ ·çš„ï¼š<br><img src="/sunsx9316/APP%E5%88%87%E6%8D%A2%E4%B8%BB%E9%A2%98%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/img.jpg" alt="img"></p>
<h3 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h3><p>å®é™…ä½¿ç”¨ä¸­ï¼Œè¿™ä¸ªè½®å­å¹¶ä¸å¤ªæ–¹ä¾¿ã€‚ä¸€æ˜¯å› ä¸ºä»£ç éƒ½åœ¨ <code>Plist</code> é‡Œï¼Œä¸èƒ½éå¸¸ç›´è§‚çš„çœ‹åˆ°æ ·å¼çš„è®¾ç½®è¿‡ç¨‹ã€‚è€Œä¸”è¦æ±‚keyä¸ç±»ä¸­çš„å±æ€§ï¼Œä»£ç ä¸€æ—¦æœ‰ä¿®æ”¹ï¼Œ<code>Plist</code>ä¹Ÿéœ€è¦åšä¿®æ”¹ã€‚æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ <code>Value</code> å­—ç¬¦ä¸²çš„ä¹¦å†™ä¸èƒ½å‡ºé”™ï¼Œä½†è¿™æ˜¯ä¸å¤ªå®¹æ˜“çš„ï¼Œå› ä¸ºäººå°±æ˜¯ä¸ªBugã€‚</p>
<p>æ¯”è¾ƒå¥½çš„è§£å†³æ–¹å¼å°±æ˜¯å†™ä¸ªGUIå·¥å…·ï¼Œèƒ½æµè§ˆå’Œç”Ÿæˆé…ç½®ï¼Œè€Œä¸æ˜¯é€šè¿‡æ‰‹å·¥æ·»åŠ ã€‚</p>
</div></article></div></main><footer><div class="paginator"><a href="/sunsx9316/2018/08/26/iOS%E7%9A%84MobileVLCKit%E6%A1%86%E6%9E%B6%E6%92%AD%E6%94%BESMB%E5%8D%8F%E8%AE%AE%E8%A7%86%E9%A2%91%E7%9A%84%E9%97%AE%E9%A2%98/" class="prev">ä¸Šä¸€ç¯‡</a><a href="/sunsx9316/2018/08/26/UITableView-FDTemplateLayoutCell%E8%AE%A1%E7%AE%97%E8%A1%8C%E9%AB%98%E4%B8%80%E4%BA%9B%E7%BC%BA%E9%99%B7%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/" class="next">ä¸‹ä¸€ç¯‡</a></div><div class="copyright"><p>Â© 2018 - 2021 <a href="https://github.com/sunsx9316">jimhuang</a> | Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>