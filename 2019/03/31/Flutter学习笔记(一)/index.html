<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Flutter学习笔记(一) · Jim Huang的博客</title><meta name="description" content="Flutter学习笔记(一) - Jim Huang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://sunsx9316.github.io/atom.xml" title="Jim Huang的博客"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/sunsx9316" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Flutter学习笔记(一)</h1><div class="post-info">Mar 31, 2019</div><div class="post-content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>近来大前端时代成为了一个很火热的词，各种跨平台的前端框架也不断涌现。不过我个人其实并不太看好这种框架，个人感觉一套代码全平台通用的想法是很好，但是平台是存在差异性的，特别是每个平台还有很多特有的属性，所以要做好终归只能原生。不过作为程序员，学习和了解新技术总没什么错，特别是要清楚本质，所以这里记录下自己学习<a href="https://flutter.dev/" target="_blank" rel="noopener">flutter</a>的过程。</p>
<h2 id="Flutter是啥"><a href="#Flutter是啥" class="headerlink" title="Flutter是啥"></a>Flutter是啥</h2><p><a href="https://flutter.dev/" target="_blank" rel="noopener">flutter</a>是Google开发，用于跨平台开发(目前支持Android和iOS)的一个框架。相比于H5+原生混合开发、React Native或Weex，flutter诞生的比较晚，从第一个beta版本到现在也不过一年。但是可以看到在Google强大的号召力下，开源社区非常火热。flutter和React Native、Weex这些框架最大的区别，应该在于flutter采用自绘引擎，既不使用原生控件，也不使用webView。这样的好处是能做到多端UI表现的一致，也就是真正意义的跨平台了。不过UI其实只是一部分，将来希望能做到更多API的统一。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>万丈高楼平地起，这一章主要说安装。</p>
<p>flutter的社区很火热，在国内有专门的<a href="https://flutterchina.club/flutter-for-ios/#%E6%88%91%E6%80%8E%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8E%9F%E7%94%9F%E9%9B%86%E6%88%90%E5%B1%82" target="_blank" rel="noopener">中文网</a>，仔细阅读就能解决国内开发基本都会碰到的问题。所以上面写了的我就简单略过，只讲自己碰到的坑。</p>
<p>因为安卓是亲儿子，flutter对于Android的支持完善的多，而苦逼的iOS搭建完整的开发环境还是相对麻烦。本人使用VSCode+插件的方式开发，前面的配置环境变量，安装插件什么的一切顺利，主要问题出现在了安装iOS设备工具这里。</p>
<p>本人使用的是稳定版本，目前是<a href="https://storage.googleapis.com/flutter_infra/releases/stable/macos/flutter_macos_v1.2.1-stable.zip" target="_blank" rel="noopener">v1.2.1</a>。<br>官方的说明很简单，通过<a href="https://brew.sh/" target="_blank" rel="noopener">Homebrew</a>一键安装：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">brew update</span><br><span class="line">brew install --HEAD libimobiledevice</span><br><span class="line">brew install ideviceinstaller ios-deploy cocoapods</span><br><span class="line">pod setup</span><br></pre></td></tr></table></figure></p>
<p>问题出在了<code>brew install --HEAD libimobiledevice</code>这个东西上。<br>因为Homebrew会自动检测包依赖，然后他帮我装了<code>python</code>，这就是噩梦的开始。</p>
<p>默认Homebrew安装的是python3，而Mac OS自带的是python2。所以就会出现两个版本。不过不用担心Homebrew会帮你处理好。由于本人python只是略懂皮毛，所以以下的处理方式可能在专业人士看来比较不妥，有更好的方式欢迎给我提issue。</p>
<p>安装出现了这个错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">checking consistency of all components of python development environment... no</span><br><span class="line">configure: error:</span><br><span class="line">  Could not link test program to Python. Maybe the main Python library has been</span><br><span class="line">  installed in some non-standard library path. If so, pass it to configure,</span><br><span class="line">  via the LDFLAGS environment variable.</span><br><span class="line">  Example: ./configure LDFLAGS=&quot;-L/usr/non-standard-path/python/lib&quot;</span><br><span class="line">  ============================================================================</span><br><span class="line">   ERROR!</span><br><span class="line">   You probably have to install the development version of the Python package</span><br><span class="line">   for your distribution.  The exact name of this package varies among them.</span><br><span class="line">  ============================================================================</span><br></pre></td></tr></table></figure>
<p>emmm …… 我当时就是这个表情<img src="//sunsx9316.github.io/2019/03/31/Flutter学习笔记(一)/6F4AFA5C079CB313AE50613696E1D366.jpg" alt="img"> </p>
<p>查了下发现<code>libimobiledevice</code>这是一个用来和iPhone通信的库，如果不管其实也可以，但是就没法体验flutter的热重载了。所以我们还是得上。错误大致上是说不能链接到python。于是看了看flutter在github上的issue，发现还真有人碰到。大致说这是Homebrew的问题，但是解决方法没说明白。再google，有一些和flutter无关的搜索结果，给出的解决方案大多是安装python-dev，这玩意是Linux上的，mac没有，那就只能自己琢磨了。</p>
<p>一开始猜测可能是多版本python的问题，导致脚本找不到python真正的目录，google之后发现可以通过配置$PATH的方式将python路径加入到环境变量中。命令如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$&#123;PATH&#125;:/Library/Frameworks/Python.framework/Versions/3.6/bin</span><br></pre></td></tr></table></figure></p>
<p>满怀希望的再装一次，发现还是报这个错。于是看看他的log，有这么一段话：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">via the LDFLAGS environment variable.</span><br><span class="line">  Example: ./configure LDFLAGS=&quot;-L/usr/non-standard-path/python/lib&quot;</span><br></pre></td></tr></table></figure>
<p>大概是让我执行<code>./configure</code>这个文件的时候指定<code>LDFLAGS</code>这个环境变量为外部的python路径。log里有报错的脚本路径，我的在这里：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/Library/Caches/Homebrew/libimobiledevice:</span><br></pre></td></tr></table></figure>
<p>cd到这个目录，发现是Homebrew缓存libimobiledevice安装脚本的目录。里面有Log提到的<code>configure</code>文件。熟悉Linux的同学应该知道这玩意，这个是手动编译一些库的时候常见的配置脚本。其实这里就是要我们自己手动安装了。好，那我们自己手动加上Python的外部路径，Homebrew的python安装在这里:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/Cellar/python/3.7.3/Frameworks/Python.framework/Versions/3.7/lib</span><br></pre></td></tr></table></figure></p>
<p>在当前目录执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure LDFLAGS=&quot;-L/usr/local/Cellar/python/3.7.3/Frameworks/Python.framework/Versions/3.7/lib&quot;</span><br></pre></td></tr></table></figure></p>
<p>满心欢喜，发现并没有什么卵用。以为是书写方式或者路径不对，做了很多尝试，依然无果。<img src="//sunsx9316.github.io/2019/03/31/Flutter学习笔记(一)/0DAFA227E38C20F61AB1A971BCF784D6.jpg" alt="img1"> 只能看看脚本写的是啥了。</p>
<p>编辑器打开<code>./configure</code>，发现是个shell脚本。搜了下报错信息，发现了这么些代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">if ac_fn_c_try_link &quot;$LINENO&quot;; then :</span><br><span class="line">  pythonexists=yes</span><br><span class="line">else</span><br><span class="line">  pythonexists=no</span><br><span class="line">fi</span><br><span class="line">rm -f core conftest.err conftest.$ac_objext \</span><br><span class="line">    conftest$ac_exeext conftest.$ac_ext</span><br><span class="line"></span><br><span class="line">	&#123; $as_echo &quot;$as_me:$&#123;as_lineno-$LINENO&#125;: result: $pythonexists&quot; &gt;&amp;5</span><br><span class="line">$as_echo &quot;$pythonexists&quot; &gt;&amp;6; &#125;</span><br></pre></td></tr></table></figure></p>
<p>以我半桶水的shell基础大致就是尝试链接python，底下的代码会通过<code>pythonexists</code>这个标识判断是否链接成功。我们的python其实是能找到的，但是上面的代码不知道为啥报错了，于是我试着在<code>rm -f core conftest.err conftest.$ac_objext</code>的上一行直接粗暴的把<code>pythonexists</code>改为yes。像这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if ac_fn_c_try_link &quot;$LINENO&quot;; then :</span><br><span class="line">  pythonexists=yes</span><br><span class="line">else</span><br><span class="line">  pythonexists=no</span><br><span class="line">fi</span><br><span class="line">pythonexists=yes # 加入这行</span><br><span class="line">rm -f core conftest.err conftest.$ac_objext \</span><br></pre></td></tr></table></figure>
<p>保存运行，发现真的没报这个错了。但是又迎来了另一个错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">checking for openssl &gt;= 0.9.8... no</span><br><span class="line">configure: error: OpenSSL support explicitly requested but OpenSSL could not be found</span><br></pre></td></tr></table></figure>
<p>WTF？OpenSSL我明明装了，这又搞毛线。google一下发现是mac自带的版本比较旧，最简单的方法是这样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./autogen.sh --disable-openssl</span><br></pre></td></tr></table></figure></p>
<p>然后居然没报错，Every Thing is OK. 接下来 <code>make install</code>就好了。</p>
<p>然后没有两秒又报错了？？？<img src="//sunsx9316.github.io/2019/03/31/Flutter学习笔记(一)/1e976bbd4b19f323633b83bfea11016f7b4290fa.gif" alt="img2"></p>
<p>好吧，看看报错。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.14.sdk/usr/include/inttypes.h:250:8: error:</span><br><span class="line">      unknown type name &apos;intmax_t&apos;</span><br></pre></td></tr></table></figure></p>
<p>说的是系统的SDK里没有定义<code>intmax_t</code>这东西，猜测是编译版本的问题。goolge发现人家直接简单粗暴给你加上定义。我们打开Xcode看下<code>intmax_t</code>的定义。</p>
<p>长这样的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#ifndef _INTMAX_T</span><br><span class="line">#define _INTMAX_T</span><br><span class="line">#ifdef __INTMAX_TYPE__</span><br><span class="line">typedef __INTMAX_TYPE__ intmax_t;</span><br><span class="line">#else</span><br><span class="line">#ifdef __LP64__</span><br><span class="line">typedef long int intmax_t;</span><br><span class="line">#else</span><br><span class="line">typedef long long int intmax_t;</span><br><span class="line">#endif /* __LP64__ */</span><br><span class="line">#endif /* __INTMAX_TYPE__ */</span><br><span class="line">#endif /* _INTMAX_T */</span><br></pre></td></tr></table></figure>
<p>其实就是个INTMAX的别名。然后我们把他粘贴到上面报错的头文件中。(<code>uintmax_t</code>也是一样)</p>
<p>之后出现的错误都类似处理，补全定义。</p>
<p>然后，编译通过了~ <img src="//sunsx9316.github.io/2019/03/31/Flutter学习笔记(一)/66179FCE3CB80A6F43E547D593B29907.gif" alt="img3"></p>
<p>当然，随便改系统定义的头文件不知道会有什么后果，所以在安装完成之后我就把他复原了。接下来试试flutter的热重载，正常，安装到此结束。</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>其实还尝试过Android Studio，结果新建flutter工程直接卡死，心累不想找解决方案了，以后flutter能省点心就好了。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2019/08/17/用更优雅的方式使用KVO/" class="prev">PREV</a><a href="/2018/12/15/对于订阅和反订阅的一些思考/" class="next">NEXT</a></div><div class="copyright"><p>© 2018 - 2019 <a href="https://sunsx9316.github.io">Jim Huang</a> | Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>